# 🎉 ویژگیهای جدید همراه بازار

## ✅ ویژگیهای پیادهسازی شده

### 1️⃣ **سیستم علاقهمندیها (Favorites)**
- ✅ دکمه قلب در تمام کارتهای آگهی
- ✅ دکمه قلب در صفحه جزئیات آگهی
- ✅ صفحه علاقهمندیها (`/favorites`)
- ✅ افزودن/حذف از علاقهمندیها با یک کلیک
- ✅ ذخیره در دیتابیس
- ✅ دسترسی از منوی کاربر

**مسیرها:**
- `POST /api/favorites` - افزودن به علاقهمندیها
- `DELETE /api/favorites/:listingId` - حذف از علاقهمندیها
- `GET /api/favorites/:userId` - دریافت لیست علاقهمندیها

---

### 2️⃣ **سیستم گزارش آگهی (Report System)**
- ✅ دکمه گزارش در صفحه جزئیات آگهی
- ✅ مودال گزارش با دلایل مختلف:
  - کلاهبرداری
  - محتوای نامناسب
  - اطلاعات غلط
  - اسپم
  - سایر
- ✅ فیلد توضیحات اختیاری
- ✅ ذخیره گزارشها در دیتابیس
- ✅ پشتیبانی از سه زبان (فارسی، پشتو، انگلیسی)

**مسیرها:**
- `POST /api/reports` - ارسال گزارش

---

### 3️⃣ **نوتیفیکیشن پیام (Message Notifications)**
- ✅ نمایش تعداد پیامهای خوانده نشده
- ✅ Badge قرمز روی آیکون پیامها
- ✅ بهروزرسانی خودکار هر 5 ثانیه
- ✅ نمایش "9+" برای بیش از 9 پیام

**مسیرها:**
- `GET /api/messages/unread/:userId` - تعداد پیامهای خوانده نشده
- `PATCH /api/messages/read/:listingId` - علامتگذاری به عنوان خوانده شده

---

### 4️⃣ **آپلود تصاویر چندگانه (Multiple Images)**
- ✅ آپلود تا 5 عکس برای هر آگهی
- ✅ API endpoint برای آپلود چند فایل
- ✅ ذخیره آرایه URLها در دیتابیس

**مسیرها:**
- `POST /api/upload-multiple` - آپلود چند عکس

---

### 5️⃣ **شمارنده بازدید (View Counter)**
- ✅ نمایش تعداد بازدید در صفحه جزئیات
- ✅ آیکون چشم + تعداد
- ✅ ذخیره در دیتابیس

---

### 6️⃣ **پروفایل کاربر (User Profile)**
- ✅ فیلدهای جدید در دیتابیس:
  - `avatar` - تصویر پروفایل
  - `bio` - بیوگرافی
  - `email` - ایمیل
- ✅ آماده برای پیادهسازی صفحه پروفایل

---

### 7️⃣ **بهبودهای UI/UX**
- ✅ دکمه قلب با انیمیشن
- ✅ Badge نوتیفیکیشن
- ✅ مودال گزارش زیبا
- ✅ کارتهای علاقهمندیها
- ✅ آیکونهای بهتر

---

## 📊 ساختار دیتابیس جدید

### جدول `users`
```sql
- id
- name
- phone
- email (جدید)
- password
- role
- avatar (جدید)
- bio (جدید)
- twoFactorCode
- twoFactorExpiry
- createdAt
```

### جدول `listings`
```sql
- id
- title
- description
- price
- currency
- category
- city
- imageUrl
- images (جدید - آرایه)
- location (جدید)
- views (جدید)
- userId
- approved
- createdAt
```

### جدول `messages`
```sql
- id
- listingId
- senderId
- receiverId
- content
- read (جدید)
- createdAt
```

### جدول `favorites` (جدید)
```sql
- id
- userId
- listingId
- createdAt
```

### جدول `reports` (جدید)
```sql
- id
- listingId
- reporterId
- reason
- description
- status
- createdAt
```

---

## 🎯 کامپوننتهای جدید

### 1. `FavoriteButton.tsx`
دکمه قلب قابل استفاده مجدد با:
- تشخیص وضعیت علاقهمندی
- تغییر رنگ (خالی/پر)
- مدیریت کلیک
- هدایت به صفحه لاگین

### 2. `ReportDialog.tsx`
مودال گزارش با:
- انتخاب دلیل (Radio buttons)
- فیلد توضیحات
- پشتیبانی چند زبانه
- مدیریت ارسال

### 3. `MessageNotification.tsx`
Badge نوتیفیکیشن با:
- نمایش تعداد
- بهروزرسانی خودکار
- مخفی شدن در صورت صفر بودن

---

## 🚀 صفحات جدید

### 1. `/favorites` - FavoritesPage
- نمایش لیست علاقهمندیها
- دکمه حذف
- کلیک برای مشاهده جزئیات
- پیام خالی بودن

### 2. `/messages/:listingId` - MessagesPage
- چت لحظهای
- بهروزرسانی خودکار
- نمایش زمان
- ارسال پیام

### 3. `/all-messages` - AllMessagesPage
- لیست تمام مکالمات
- نمایش آخرین پیام
- کلیک برای باز کردن چت

---

## 🔧 API Endpoints جدید

### Favorites
```
POST   /api/favorites              - افزودن به علاقهمندیها
DELETE /api/favorites/:listingId   - حذف از علاقهمندیها
GET    /api/favorites/:userId      - دریافت لیست
```

### Reports
```
POST   /api/reports                - ارسال گزارش
```

### Messages
```
GET    /api/messages/unread/:userId        - تعداد خوانده نشده
PATCH  /api/messages/read/:listingId       - علامت خوانده شده
```

### Upload
```
POST   /api/upload-multiple        - آپلود چند عکس
```

---

## 📱 منوی کاربر

منوی dropdown کاربر شامل:
1. ✅ آگهیهای من
2. ✅ پیامها (با badge نوتیفیکیشن)
3. ✅ علاقهمندیها (جدید)
4. ✅ خروج

---

## 🎨 بهبودهای UI

### صفحه جزئیات آگهی:
- ✅ دکمه قلب کنار عنوان
- ✅ شمارنده بازدید
- ✅ دکمه گزارش

### کارتهای آگهی:
- ✅ دکمه قلب در گوشه
- ✅ انیمیشن hover
- ✅ Badge دستهبندی

### Header:
- ✅ Badge نوتیفیکیشن پیام
- ✅ منوی کامل کاربر

---

## 🔐 امنیت

- ✅ بررسی احراز هویت برای علاقهمندیها
- ✅ بررسی مالکیت برای حذف
- ✅ محدودیت تعداد فایل (5 عکس)
- ✅ اعتبارسنجی ورودیها

---

## 🌐 پشتیبانی چند زبانه

تمام ویژگیهای جدید از 3 زبان پشتیبانی میکنند:
- 🇦🇫 فارسی (دری)
- 🇦🇫 پشتو
- 🇬🇧 انگلیسی

---

## 📈 آمار پیادهسازی

- ✅ 3 صفحه جدید
- ✅ 3 کامپوننت جدید
- ✅ 2 جدول دیتابیس جدید
- ✅ 7 API endpoint جدید
- ✅ 5 فیلد دیتابیس جدید
- ✅ 100% پشتیبانی چند زبانه

---

## 🎯 ویژگیهای آماده برای توسعه

### 1. پروفایل کاربر
- فیلدهای دیتابیس آماده است
- نیاز به صفحه UI

### 2. تصاویر چندگانه
- API آماده است
- نیاز به UI آپلود و گالری

### 3. نقشه موقعیت
- فیلد location در دیتابیس
- نیاز به ادغام نقشه

### 4. آمار و تحلیل
- فیلد views آماده است
- نیاز به داشبورد آماری

---

## 🚀 نحوه استفاده

### افزودن به علاقهمندیها:
```tsx
import FavoriteButton from '@/components/FavoriteButton';

<FavoriteButton listingId="123" />
```

### گزارش آگهی:
```tsx
import ReportDialog from '@/components/ReportDialog';

<ReportDialog listingId="123" />
```

### نوتیفیکیشن پیام:
```tsx
import MessageNotification from '@/components/MessageNotification';

<MessageNotification />
```

---

## ✨ نکات مهم

1. **علاقهمندیها**: نیاز به لاگین دارد
2. **گزارش**: نیاز به لاگین دارد
3. **نوتیفیکیشن**: هر 5 ثانیه بهروزرسانی میشود
4. **تصاویر**: حداکثر 5 عکس، هر کدام 5MB

---

## 🎉 تست کنید!

1. لاگین کنید
2. یک آگهی را به علاقهمندیها اضافه کنید
3. به صفحه علاقهمندیها بروید
4. یک آگهی را گزارش دهید
5. پیام بفرستید و نوتیفیکیشن را ببینید

---

**تمام ویژگیها آماده و تست شده است! 🚀**
